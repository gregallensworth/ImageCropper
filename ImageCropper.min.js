jQuery.fn.ImageCropper=function(e){function t(){var e=parseInt(h.width)*u,t=parseInt(h.height)*u,i=(r.width()-e)/2,n=(r.height()-t)/2;r.css({"background-image":"url("+h.src+")","background-size":e+"px "+t+"px","background-position":i+"px "+n+"px","background-repeat":"no-repeat"})}function i(){u*=1.25,t()}function n(){u*=.8,t()}function a(){var t=e.width,i=e.height,n=r.css("background-position").split(" "),a=r.css("background-size").split(" "),s=parseInt(n[0])-r.width()/2+t/2,u=parseInt(n[1])-r.height()/2+i/2,l=parseInt(a[0]),c=parseInt(a[1]),g=parseInt(h.height),m=parseInt(h.width),v=document.createElement("canvas");v.width=t,v.height=i;var b=v.getContext("2d");b.drawImage(h,0,0,m,g,s,u,l,c);var f=v.toDataURL("image/jpeg");p.prop("src",f).show(),o.val(f.replace("data:image/jpeg;base64,","")),d.hide(),e.clearFileInput&&$fileinput.val("")}e=$.extend({width:1024,height:768,thumbWidth:256,thumbHeight:192,fieldName:$(this).prop("name"),clearFileInput:!0},e),$fileinput=$(this);var p=$('<img src="about:blank" />').hide().addClass("imageCropperThumbnail").width(e.thumbWidth).height(e.thumbHeight).appendTo($fileinput.parent()),o=$('<input type="hidden" />').prop("name",e.fieldName).val("").appendTo($fileinput.parent()),d=$("<div></div>").addClass("imageCropperWrapper").appendTo($fileinput.parent()).width(e.width).hide(),r=$("<div></div>").addClass("imageCropperCanvas").appendTo(d).width(e.width).height(e.height),s=$("<div></div>").addClass("imageCropperButtons").appendTo(d),u=($('<input type="button" value="+" />').appendTo(s).click(i),$('<input type="button" value="Crop & Save" />').appendTo(s).click(a),$('<input type="button" value="-" />').appendTo(s).click(n),1),h=new Image;h.onload=function(){d.show(),u=1,t()},$fileinput.val("").change(function(){var e=new FileReader;e.onload=function(e){h.src=e.target.result},e.readAsDataURL(this.files[0])});var l,c,g;r.bind("mousedown",function(e){e.stopImmediatePropagation(),g=!0,l=e.clientX,c=e.clientY}).bind("mousemove",function(e){if(e.stopImmediatePropagation(),g){var t=e.clientX-l,i=e.clientY-c,n=r.css("background-position").split(" "),a=t+parseInt(n[0]),p=i+parseInt(n[1]);r.css("background-position",a+"px "+p+"px"),l=e.clientX,c=e.clientY}}).bind("mouseout",function(e){g=!1}).bind("mouseup",function(e){g=!1}).bind("mousewheel DOMMouseScroll",function(e){e.originalEvent.wheelDelta>0||e.originalEvent.detail<0?i():n()})};